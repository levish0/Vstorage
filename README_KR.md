# Vstorage

어떤 파일이든 4K 영상으로 인코딩하세요.
손실 압축(YouTube 등)을 거친 후에도 다시 디코딩할 수 있습니다.

AES-256-GCM 암호화, 리드-솔로몬 오류 정정, 그리고 양자화된 픽셀 블럭 사용.

## 요구 사항

- Rust 1.56+
- FFmpeg (환경 변수에 등록되어 있어야 함)

## 설치

```
cargo install --path .
```

## 사용법

### 인코딩

```
cargo run --release -- encode -i <FILE> -o <VIDEO> [OPTIONS]
```

| 플래그                      | 기본값  | 설명                                         |
|-----------------------------|---------|----------------------------------------------|
| `-i, --input <INPUT>`       |         | 인코딩할 파일 경로                            |
| `-o, --output <OUTPUT>`     |         | 인코딩된 파일 경로 (.mp4)                     |
| `-p, --password <PASSWORD>` |         | 비밀번호 암호화 (선택적)                       |
| `--block-size <BLOCK_SIZE>` | 8       | 논리적 블럭마다 픽셀 수                        |
| `--levels <LEVELS>`         | 2       | 채널마다 양자화 레벨 (2의 거듭제곱)             |
| `--fps <FPS>`               | 30      | 초당 프레임 수                                |
| `--crf <CRF>`               | 18      | FFmpeg CRF 퀄리티 (낮을 수록 나음)             |
| `--ecc <ECC>`               | 64      | 리드-솔로몬 오류 정정 코드(ECC) 패리티 바이트   |

### 디코딩

```
cargo run --release -- decode -i <VIDEO> -o <FILE>
```

| 플래그                      | 설명                         |
|-----------------------------|------------------------------|
| `-i, --input <INPUT>`       | 디코딩할 비디오 경로           |
| `-o, --output <OUTPUT>`     | 디코딩된 파일 경로            |
| `-p, --password <PASSWORD>` | 복호화 비밀번호 (암호화 시)    |

디코더는 영상 헤더에서 블록 크기, 레벨, ECC 정보를 자동으로 읽어옵니다.

## 기본 설정

기본값은 YouTube의 재압축을 견딜 수 있도록 조정되어 있습니다:

| 설정             | 기본값           | 이유                                    |
|------------------|------------------|-----------------------------------------|
| `--block-size 8` | 8x8 픽셀 블럭     | yuv420p 크로마 슈퍼샘플링에 견딤          |
| `--levels 2`     | 0 아니면 255 만   | 최대 노이즈 허용 범위 (±127)              |
| `--ecc 64`       | 64 패리티 파이드  | 블록당 최대 32바이트 오류를 수정          |

만약 유튜브를 거친 동영상이 디코딩에 실패한다면 더 많은 오류 정정을 위해 `--ecc 128`를 사용하세요.

YouTube를 거치지 않는 로컬 사용 환경에서는 다음과 같이 설정하여 저장 용량을 증가시킬 수 있습니다:

```
cargo run --release -- encode -i myfile.zip -o output.mp4 --block-size 2 --levels 4 --ecc 32
```

## 용량

| 프리셋                              | 프레임당  | 분당 (30fps)       |
|-------------------------------------|-----------|--------------------|
| 기본    (block=8, levels=2, ecc=64) | ~35 KB    | ~63 MB             |
| Local (block=2, levels=4, ecc=32)   | ~1.3 MB   | ~2.3 GB            |
